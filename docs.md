<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [WebhookHelpers][1]
    -   [Parameters][2]
    -   [Examples][3]
    -   [get][4]
        -   [Parameters][5]
        -   [Examples][6]
    -   [set][7]
        -   [Parameters][8]
        -   [Examples][9]
    -   [getTaskData][10]
        -   [Parameters][11]
    -   [setTaskData][12]
        -   [Parameters][13]
        -   [Examples][14]
    -   [getMailBotData][15]
        -   [Parameters][16]
        -   [Examples][17]
    -   [setMailBotData][18]
        -   [Parameters][19]
        -   [Examples][20]
    -   [getReferenceEmail][21]
        -   [Examples][22]
    -   [setReferenceEmail][23]
        -   [Parameters][24]
        -   [Examples][25]
    -   [getReplyTo][26]
        -   [Examples][27]
    -   [addEmail][28]
        -   [Parameters][29]
        -   [Examples][30]
    -   [quickReply][31]
        -   [Parameters][32]
        -   [Examples][33]
    -   [setTriggerTime][34]
        -   [Parameters][35]
        -   [Examples][36]
    -   [setTriggerTimestamp][37]
        -   [Parameters][38]
        -   [Examples][39]
    -   [invite][40]
        -   [Parameters][41]
        -   [Examples][42]
    -   [completeTask][43]
        -   [Examples][44]
    -   [getAllContacts][45]
        -   [Examples][46]
    -   [respond][47]
        -   [Parameters][48]
        -   [Examples][49]
    -   [settingsPage][50]
        -   [Parameters][51]
        -   [Examples][52]
-   [SettingsPage][53]
    -   [Parameters][54]
    -   [Examples][55]
    -   [getSettingsFormJSON][56]
        -   [Examples][57]
    -   [insert][58]
        -   [Parameters][59]
        -   [Examples][60]
    -   [input][61]
        -   [Parameters][62]
        -   [Examples][63]
    -   [textarea][64]
        -   [Parameters][65]
        -   [Examples][66]
    -   [checkbox][67]
        -   [Parameters][68]
        -   [Examples][69]
    -   [select][70]
        -   [Parameters][71]
        -   [Examples][72]
    -   [alert][73]
        -   [Parameters][74]
        -   [Examples][75]
    -   [video][76]
        -   [Parameters][77]
        -   [Examples][78]
    -   [text][79]
        -   [Parameters][80]
        -   [Examples][81]
    -   [hiddenInput][82]
        -   [Parameters][83]
        -   [Examples][84]
    -   [submitButton][85]
        -   [Parameters][86]
        -   [Examples][87]
    -   [populate][88]
        -   [Parameters][89]
        -   [Examples][90]
-   [listen][91]
-   [exportApp][92]
-   [loadSkill][93]
    -   [Parameters][94]
-   [on][95]
    -   [Parameters][96]
-   [onCommand][97]
    -   [Parameters][98]
-   [onTrigger][99]
    -   [Parameters][100]
-   [onEvent][101]
    -   [Parameters][102]
-   [onAction][103]
    -   [Parameters][104]
-   [onTaskViewed][105]
    -   [Parameters][106]
-   [onSettingsViewed][107]
    -   [Parameters][108]
-   [beforeSettingsSaved][109]
    -   [Parameters][110]
-   [on][111]

## WebhookHelpers

The 'bot' object passed into the handlers comes with a number
of helpers to handle the request.

NOTE: This class is automatically instantiated with an instance
of BotRequest and made available under bot.webhook.

### Parameters

-   `botRequest` **[object][112]** An instnace of BotRequest
    -   `botRequest.botRequest`  

### Examples

```javascript
bot.webhook.getMailBotData('memorize.settings');
```

### get

Get the current value of a key.
If a value has already been been set
on the responseJson object, it return that value,
otherwise it returns the value in the request object.

#### Parameters

-   `key` **[string][113]** JSON path to key
-   `defaultValue` **mixed** Default if key is falsy

#### Examples

```javascript
bot.webhook.get('source.from'); // sender's email address
```

```javascript
bot.get('source.from'); // this method is also aliased directly on bot
```

### set

Set attributes on the this.responseJson object. If existing value and
new value are both objects (not Arrays) they are shallow-merged.
If new or old data are not objects, the value of the key is replaced
entirely.

#### Parameters

-   `key` **[string][113]** JSON Path to object within responseJson object
-   `value` **any** Value
-   `merge` **[boolean][114]** Objets are shallow-merged by default. Set this to
    false to force the replacement of an object.

#### Examples

```javascript
bot.set('task.reference_email.subject', "New Subject!");
```

```javascript
bot.set('task.reference_email', { subject: "New Subject!"}); // Same effect as above
```

### getTaskData

Get data for current task

#### Parameters

-   `key` **[string][113]** JSON Path to key within task.private_data
-   `defaultValue` **any** If there is no key, return this

### setTaskData

Set data for current task
Takes either an object or a lodash \_.set path as the first param,
optionally a value as the second parameter. Objects are shallow-merged
if new and old data are objects. (Arrays and other types are replaced).

#### Parameters

-   `args` **...any** 

#### Examples

```javascript
setTaskData('my_bot.magic_number', 42);
```

### getMailBotData

Get data stored in mailbot.private_data

#### Parameters

-   `key` **[string][113]** JSON Path to data from mailbot
-   `defaultValue` **any** If value is undefined, use this value instead

#### Examples

```javascript
bot.webhook.getMailBotData('my_bot.setting', 42);
```

### setMailBotData

Set data stored in mailbot.private_data. Objects are shallow merged if
existing data is present. All other values (including arrays) are replaced.

This method has two signatures. It can take an object as its only param
which will be shallowly merged into mailbot.private_data.

It can also take a lodash \_.set path as its first parameter and a value
as the second.

#### Parameters

-   `args` **...any** 
-   `param` **([string][113] \| [object][112])** Either a lodash set param or an
    object to be shallowly merged into mailbot.private_data
-   `value` **any?** When passing lodash set path string as first
    param, this is the value.

#### Examples

```javascript
bot.webhook.setMailBotData({key: "value"});
```

```javascript
bot.webhook.setMailBotData('foo.bar', "value");
```

### getReferenceEmail

Get the reference email – the abstract, user-editable instance
of the email associated with this task. Note this is not the same
as the source email (which is the exact email received).

#### Examples

```javascript
bot.webhook.getReferenceEmail();
```

### setReferenceEmail

Set reference email
Shallowly merges refernece email fields, allowing
for easy partial updates

#### Parameters

-   `referenceEmail` **[object][112]** 
    -   `referenceEmail.to` **[array][115]** Array of email address strings
    -   `referenceEmail.cc` **[array][115]** Array of email address strings
    -   `referenceEmail.bcc` **[array][115]** Array of email address strings
    -   `referenceEmail.subject` **[string][113]** Email subject
    -   `referenceEmail.reply_to` **[string][113]** Email address or action-email
    -   `referenceEmail.html` **[string][113]** html HTML content of email
    -   `referenceEmail.text` **[string][113]** html text-only content of email

#### Examples

```javascript
bot.webhook.setReferenceEmail({
  to: "test@gmail.com",
  subject: "A new subject",
  html: "This new content replaces the old"
});
```

### getReplyTo

Get replyto email, taking into this value being edited
after the original email was sent.

#### Examples

```javascript
bot.webhook.getReplyTo();
```

### addEmail

Adds another email message to the "send_messages" array, causing
the core API to send an email. Multiple emails can be sent.

#### Parameters

-   `email` **[object][112]** email object
    -   `email.to` **[string][113]** comma separated emails
    -   `email.cc` **[string][113]** comma separated emails
    -   `email.bcc` **[string][113]** comma separated emails
    -   `email.from` **[string][113]** from name only (message-envelope is always from mailbots)
    -   `email.reply_to` **[string][113]** email address or action-email
    -   `email.subject` **[string][113]** email subject
    -   `email.body` **[array][115]** Array of ui objects [https://docs.mailbots.com/docs/email-ui-reference][116]

#### Examples

```javascript
const email = bot.webhook.addEmail({
  to: bot.get('source.from'),
  subject: "A Subject",
  body: [
  {
   type: 'html',
   text: '<h1>An email</h1>'
  }]);
})

email.from = "New Sender"; // still updatable
```

Returns **[object][112]** A reference to the email object for additional changes

### quickReply

Shorthand method to send a quick reply back to the "from" address
of the incoming email. The subject and body share the same text.

#### Parameters

-   `text` **[string][113]** Content

#### Examples

```javascript
bot.webhook.quickReply("Got it!");
```

### setTriggerTime

Set trigger time for a task using natural language

#### Parameters

-   `time` **[string][113]** FollowUpThen-style time description

#### Examples

```javascript
bot.webhook.setTriggerTime("monday");
```

```javascript
bot.webhook.setTriggerTime("every2ndWeds");
```

```javascript
bot.webhook.setTriggerTime("everyTuesday2pm");
```

### setTriggerTimestamp

Set trigger time for a task using a unix timestamp

#### Parameters

-   `timestamp` **int** Unix timestamp of trigger time

#### Examples

```javascript
bot.webhook.setTriggerTimestamp(1546139899);
```

### invite

Trigger MailBots to invite the given email address(es) to use a bot

#### Parameters

-   `invitees` **[array][115]** Array of email addresses

#### Examples

```javascript
bot.webhook.invite(['user1@email.com','newUser2@gmail.com']);
```

### completeTask

Mark task a completed. The task will be archived until permenantly deleted.

#### Examples

```javascript
bot.webhook.completeTask();
```

### getAllContacts

Fetch all contacts associated with the task's reference_email. User's
address and MailBots addresses are excluded.

Note: This uses reference_email, allowing a user to add
or remove additional recipients from the task.

#### Examples

```javascript
bot.webhook.getAllContacts();
```

Returns **[array][115]** Email addresses

### respond

Respond to (and end) the webhook response with the JSON provided.
Multi-fire handlers (like onSettingsViewed) automatically respond.
In the case where an error-condition causes an early return / response
calling this method prevents the handler from trying to return a
second time. Provided JSON is shallowly merged into response object.

#### Parameters

-   `json` **[object][112]** Response JSON

#### Examples

```javascript
bot.webhook.respond();
```

### settingsPage

Creates a new settings page, rendered in the Bot Settings section
of the Admin UI. See SettingsPage docs for details

#### Parameters

-   `params` **[object][112]** 
    -   `params.namespace` **[string][113]** Namespace used on mailbot.private_data
    -   `params.title` **[string][113]** Page title (optional, default `""`)
    -   `params.menuTitle` **menuTitle** Menu item title

#### Examples

```javascript
const.settingsPage = bot.webhook.settingsPage({
  namespace: "mem",
  title: "Memorization Settings",
  menuTitle: "Memorization"
});
```

## SettingsPage

Create a new settings page

Bots and bot skills can create settings settings pages which live
in `responseJson.settings[namespace]`. This class represents one
such settings form. Each settings form lives in its own namespace.
Instantiating a new SettingsPage adds a new namespace to
`responseJson.settings` key and populates it with React JSON Form
Schema JSON. [https://github.com/mozilla-services/react-jsonschema-form][117]
The MailBots Admin UI loops through namespaces, rendering forms appropriately.

NOTE: This class directly mutates MailBot's response JSON to add
settings pages and form fields.

### Parameters

-   `params` **[object][112]** Object params
    -   `params.responseJson` **[object][112]** Reference to MailBots responseJson obj
    -   `params.title` **[string][113]** Display title of settings page (optional, default `""`)
    -   `params.menuTitle` **[string][113]** Menu name
    -   `params.namespace`  

### Examples

```javascript
const mySettingsPage = mailbots.webhook.settingsPage({
 namespace: "memorize",
 title: "Memorization Settings",
 menuTitle: "Memorization"
});

// Add elements to the page
mySettingsPage.input({ name: "first_name"}); // renders text input
```

### getSettingsFormJSON

Retrieve the JSON Form Schema for this form

#### Examples

```javascript
const thisJsonSchema = settingsForm.getSettingsFormJSON();
```

Returns **[object][112]** JSON Form Schema

### insert

Low-level function to insert raw JSONSchema and uiSchema to
create custom form elements.
Mozilla's React JSON Schema Form manages the form JSON and
UI JSON as two separate objects to keep the form JSON prestine and
compliant. This method lets us manage a form element in one place. 
Ref: [https://github.com/mozilla-services/react-jsonschema-form][117]

#### Parameters

-   `params` **[object][112]** 
    -   `params.name` **[object][112]** Namespace
    -   `params.JSONSchema` **[object][112]** JSON Schema
    -   `params.uiSchema` **[object][112]** Corresponding uiSchemaThis example is taken from [https://mozilla-services.github.io/react-jsonschema-form/][118]

#### Examples

```javascript
formPage.insert({
name: "first_name",
JSONSchema: { type: "string", title: "First name" }, // JSON Schema
uiSchema: { "ui:autofocus": true, "ui:emptyValue": "" } // UI Schema
});
```

### input

Add text input field

#### Parameters

-   `params` **[Object][112]** 
    -   `params.name` **[string][113]** 
    -   `params.title` **[string][113]** 
    -   `params.description` **[string][113]** 
    -   `params.helpText` **[string][113]** 
    -   `params.placeholder` **[string][113]** 
    -   `params.defaultValue` **[string][113]** 

#### Examples

```javascript
formPage.input({
  name: "first_name",
  title:"First Name"
  description: "Type your first name",
  helpText: "Hopefully you don't need help with this",
  placeholder: "(Ex: Bruce Lee)",
  defaultValue: "John Doe",
});
```

### textarea

Add textarea input

#### Parameters

-   `params` **[Object][112]** 
    -   `params.name` **[string][113]** 
    -   `params.title` **[string][113]** 
    -   `params.description` **[string][113]** 
    -   `params.helpText` **[string][113]** 
    -   `params.placeholder` **[string][113]** 
    -   `params.defaultValue` **[string][113]** 

#### Examples

```javascript
formPage.textarea({
  name: "life_story",
  title:"Life Story",
  description: "This is a long story",
  helpText: "Just start writing",
  placeholder: "Once upon a time...",
  defaultValue: "I was born, some time passed, now I'm here"
});
```

### checkbox

Add checkbox field

#### Parameters

-   `params` **[Object][112]** 
    -   `params.name` **[string][113]** 
    -   `params.title` **[string][113]** 
    -   `params.description` **[string][113]** 
    -   `params.helpText` **[string][113]** 
    -   `params.defaultValue` **[string][113]** 

#### Examples

```javascript
formPage.checkbox({ name:"confirmation_emails", name:"Confirmation Emails"});
```

### select

Add select dropdown

#### Parameters

-   `params` **[Object][112]** 
    -   `params.name` **[string][113]** 
    -   `params.title` **[string][113]** 
    -   `params.description` **[string][113]** 
    -   `params.helpText` **[string][113]** 
    -   `params.options` **[array][115]** Array of options
    -   `params.placeholder` **[string][113]** // when no option is selected
    -   `params.defaultValue` **[string][113]** 

#### Examples

```javascript
settingsPage.select({
  name: "favorite_color",
  title: "Favorite Color",
  description: "Which color do you like the best?",
  helpText: "Choose a color",
  options: ["red", "green", "blue"],
  defaultValue: "blue",
  placeholder: "Pick one!"
 });
```

### alert

Adds a custom dialog at the top of the display form that can be used
for interrupt-messaging.

#### Parameters

-   `params` **[object][112]** 
    -   `params.title` **[string][113]** Alert box title
    -   `params.text` **[string][113]** Alert box text
    -   `params.linkText` **[string][113]** Action button link text
    -   `params.linkHref` **[string][113]** URL of button

#### Examples

```javascript
formPage.alert({
  title: "Connect",
  text: "Connect GitHub",
  linkText: "Connect",
  linkHref: "https://www.github.com"
})
```

### video

Insert Video. Only YouTube supported for now.

#### Parameters

-   `params` **[object][112]** 
    -   `params.url` **[string][113]** URL of video (optional, default `""`)
    -   `params.type`   (optional, default `"youtube"`)

#### Examples

```javascript
formPage.video({
  url: "https://www.youtube.com/watch?v=y1GyXuU2J5k",
  type: "youtube"
})
```

### text

Add a text block. Markdown supported!

#### Parameters

-   `text` **[string][113]** – Text with optional markdownNote: This field is whitespace sensitive. New lines
    cannot have leading spaces.

#### Examples

```javascript
formPage.text(`--------------
## ️⚠️ Connect Github
This is a text block here. Leading spaces can break this.
And this is a new line.

[Connect Github](http://www.google.com)

------------------
`);
```

### hiddenInput

Render a hidden input field. Useful for submitting
values behind the scenes.

#### Parameters

-   `params` **[object][112]** 
    -   `params.name` **[string][113]** Field name
    -   `params.value` **[string][113]** Field value

#### Examples

```javascript
formPage.hiddenInput({
  name: "key",
  value: "value"
});
```

### submitButton

Render a submit button for the form. (Submit button is not included
automatically). URL params can optionally be passed which makes
them available to the next handler. Make sure to validate URL input.

#### Parameters

-   `params` **[object][112]**  (optional, default `{}`)
    -   `params.submitText` **[string][113]** 
    -   `params.urlParams` **[object][112]** Key value of url params

#### Examples

```javascript
formPage.submitButton({
  submitText: "Save Settings",
  urlParams: { key: "value" }
});
```

### populate

Populate form data, overwriting default values with those newly passed.
MailBots JSON form data for this namespace can be passed directly to this
method to populate the form values.

#### Parameters

-   `formData` **[object][112]** JSON object containing form values.

#### Examples

```javascript
const storedData = mailbots.webhook.getMailBotData("mem", {});
formPage.populate(storedData);
```

## listen

Loads final skills and start http server.
Anything posted to /webhooks route is automatically handled.
Other routes must be created as usual with the Express App object.
For example: mailbots.app.get("my-route/", (req, res) => {});

## exportApp

Export app for automated testing

## loadSkill

Load MailBots skills from a directory, non-recursively.
This can be called more than once to load skills in order. Skills loaded
this method are preceeded by loadFirstCoreSkills, succeeded by loadLastCoreSkills.
This can also receive a path to a file.

### Parameters

-   `skill`  
-   `config` **[object][112]** optional skill configuration object
-   `skillPath` **[string][113]** path to skills directory

## on

Add handler for a given webhook event. Executes only the first handler
for a matching event. The first parameter can be either a string
(the named webhook event) or a function that is passed the webhook and
returns true or false to indicate if the handler should be run.
Example: controller.on('task.created', (bot, req, res) => { });
Example: controller.on((webhook) => webhook.event === 'task.created', cb)

### Parameters

-   `triggerCondition`  
-   `cb` **[function][119]** Handler function
-   `opts`  
-   `event` **([string][113] \| [function][119])** A webhook event string (ex: task.created). Or
    a function receives the webhook as a param, which returns a boolean value.

## onCommand

Captures only 'task.created' events where the command string matches

### Parameters

-   `commandSearch` **([string][113] | RexExp)** 
-   `cb`  

## onTrigger

Captures only 'task.triggered' events where the command string matches

### Parameters

-   `commandSearch` **([string][113] | RexExp)** 
-   `cb`  

## onEvent

Captures only 'mailbot.event_received' events
Note: This "Event" refers to the 3rd party webhooks
that are posted to the MailBot.

### Parameters

-   `eventSearch` **([string][113] | RexExp)** 
-   `cb`  

## onAction

Captures only 'task.action_received' events where the action string matches

### Parameters

-   `actionSearch` **([string][113] \| [RegExp][120])** 
-   `cb`  

## onTaskViewed

Captures only 'task.viewed' events where the command string matches

### Parameters

-   `commandSearch` **([string][113] | RexExp)** 
-   `cb`  

## onSettingsViewed

Handle webhook that fires when user is viewing MailBot.
ALL onSettingsViewed handlers fire when this webhook arrives. Each
handler can add and read data to and from its own namespace.

### Parameters

-   `cb` **[function][119]** Callback function that receives the bot object

## beforeSettingsSaved

Handle webhook that fires after a user hits "save" on their MailBot settings.
Newly saved settings arrive at the top-level settings object.
Existing settings are still in mailbot.stored_data.
Return webhook { status: "fail", message: "" } to abort the saving process.
Return extenesion and user data to update to save data as with other webhooks.
ALL beforeSettingsSaved handlers fire.

### Parameters

-   `cb` **[function][119]** Callback function that receives the bot object

## on

Default webhook response for unhandled webhook events

[1]: #webhookhelpers

[2]: #parameters

[3]: #examples

[4]: #get

[5]: #parameters-1

[6]: #examples-1

[7]: #set

[8]: #parameters-2

[9]: #examples-2

[10]: #gettaskdata

[11]: #parameters-3

[12]: #settaskdata

[13]: #parameters-4

[14]: #examples-3

[15]: #getmailbotdata

[16]: #parameters-5

[17]: #examples-4

[18]: #setmailbotdata

[19]: #parameters-6

[20]: #examples-5

[21]: #getreferenceemail

[22]: #examples-6

[23]: #setreferenceemail

[24]: #parameters-7

[25]: #examples-7

[26]: #getreplyto

[27]: #examples-8

[28]: #addemail

[29]: #parameters-8

[30]: #examples-9

[31]: #quickreply

[32]: #parameters-9

[33]: #examples-10

[34]: #settriggertime

[35]: #parameters-10

[36]: #examples-11

[37]: #settriggertimestamp

[38]: #parameters-11

[39]: #examples-12

[40]: #invite

[41]: #parameters-12

[42]: #examples-13

[43]: #completetask

[44]: #examples-14

[45]: #getallcontacts

[46]: #examples-15

[47]: #respond

[48]: #parameters-13

[49]: #examples-16

[50]: #settingspage

[51]: #parameters-14

[52]: #examples-17

[53]: #settingspage-1

[54]: #parameters-15

[55]: #examples-18

[56]: #getsettingsformjson

[57]: #examples-19

[58]: #insert

[59]: #parameters-16

[60]: #examples-20

[61]: #input

[62]: #parameters-17

[63]: #examples-21

[64]: #textarea

[65]: #parameters-18

[66]: #examples-22

[67]: #checkbox

[68]: #parameters-19

[69]: #examples-23

[70]: #select

[71]: #parameters-20

[72]: #examples-24

[73]: #alert

[74]: #parameters-21

[75]: #examples-25

[76]: #video

[77]: #parameters-22

[78]: #examples-26

[79]: #text

[80]: #parameters-23

[81]: #examples-27

[82]: #hiddeninput

[83]: #parameters-24

[84]: #examples-28

[85]: #submitbutton

[86]: #parameters-25

[87]: #examples-29

[88]: #populate

[89]: #parameters-26

[90]: #examples-30

[91]: #listen

[92]: #exportapp

[93]: #loadskill

[94]: #parameters-27

[95]: #on

[96]: #parameters-28

[97]: #oncommand

[98]: #parameters-29

[99]: #ontrigger

[100]: #parameters-30

[101]: #onevent

[102]: #parameters-31

[103]: #onaction

[104]: #parameters-32

[105]: #ontaskviewed

[106]: #parameters-33

[107]: #onsettingsviewed

[108]: #parameters-34

[109]: #beforesettingssaved

[110]: #parameters-35

[111]: #on-1

[112]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[113]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[114]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[115]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[116]: https://docs.mailbots.com/docs/email-ui-reference

[117]: https://github.com/mozilla-services/react-jsonschema-form

[118]: https://mozilla-services.github.io/react-jsonschema-form/

[119]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[120]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/RegExp
